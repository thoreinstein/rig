syntax = "proto3";

package rig.v1;

option go_package = "thoreinstein.com/rig/pkg/api/v1;apiv1";

// PluginService is the core interface that all Rig plugins must implement.
service PluginService {
  // Handshake is the first call made by the host to verify compatibility and establish connection state.
  rpc Handshake(HandshakeRequest) returns (HandshakeResponse);
}

message HandshakeRequest {
  // rig_version is the version of the Rig host.
  // Deprecated: Use api_version (tag 2) instead.
  string rig_version = 1 [deprecated = true];
  // api_version is the version of the Plugin API supported by the Rig host.
  string api_version = 2;
}

message HandshakeResponse {
  // plugin_version is the legacy version field.
  // Deprecated: Use plugin_semver (tag 6) for binary version or api_version (tag 4) for API contract.
  string plugin_version = 1 [deprecated = true];
  // capabilities_deprecated is the legacy capabilities field.
  // Deprecated: Use capabilities (tag 5) instead.
  repeated string capabilities_deprecated = 2 [deprecated = true];

  // plugin_id is the unique identifier for the plugin.
  string plugin_id = 3;
  // api_version is the version of the Plugin API (contract) implemented by the plugin.
  string api_version = 4;
  // capabilities is a list of features the plugin supports.
  repeated Capability capabilities = 5;
  // plugin_semver is the semantic version of the plugin binary itself.
  string plugin_semver = 6;
}

// Capability represents a specific feature or integration point provided by a plugin.
message Capability {
  // name is the unique name of the capability (e.g., "git.worktree").
  string name = 1;
  // version is the version of the capability implementation.
  string version = 2;
}
